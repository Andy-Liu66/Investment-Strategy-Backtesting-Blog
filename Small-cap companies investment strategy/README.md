# Small-cap companies investment strategy
## Abstract:
Pablo Fernandez (2018) (“It has been very easy to beat the S&P500 in 2010-2018. Several Examples”) stated that he built up 12 portfolios that, investing $100 in January 2000 became, on average $26,749 (266.49% total return) in April 2018, and these portfolios were composed following very simple rules:
1. Diversification is a must
2. A portfolio of small (market-cap) companies has outperformed long-term a portfolio of big companies
3. Unweighted indexes have outperformed weighted indexes

In this article, I will try to duplicate the investment strategies from Pablo Fernandez’s paper, and implement these strategies to Taiwan stock market through backtesting, we will see whether these strategies work well with Taiwan stock market.
## How to backtest:
I used the data downloaded from TEJ Database, including listed and unlisted companies on both exchange market and over counter market, data includes from January 1st, 2008 to July 12th ,2018 on daily basis. I did backtest via Python code, the basic idea is finding stocks to form portfolios with given investment strategy, and hold these portfolios for a year, then rebalance portfolios each year, backtest start from January 1st, 2008 end at July 12th ,2018. Details about backtesing and some notations are provided below:
1. **Number of stocks selected (rebalance) each year – “num_selected”:**
How many stocks are selected to form a portfolio each year according to given selection parameters.
2. **Criteria of selection – “by”:**
Select stocks by market value (“MV”) or price-to-book ratio (“PB”).
3. **Select stocks according to given criteria in an ascending or descending way – “ascending”:**
Select stocks by market value (“MV”) or price-to-book ratio (“PB”) in an ascending or descending way. If “ascending = True”, it means stocks will be sorted in an ascending way according to given criteria, then top n^{th} stocks will be selected (n is controlled by “num_selected”). If “Ascending = False”, vice versa. For example, given condition “by” = “MV”, “ascending” = “True”, it means the n^{th} stocks with smallest market value will be selected. Another example, given condition “by” = “PB”, “ascending” = “False”, it means the $n^{th}$ stocks with biggest price-to-book ratio will be selected.
4. **Least requirement of trade volume – “least_volume”:**
Considering liquidity risk, if traded stocks’ trade volume doesn’t meet the least requirement of trade volume on exit point, solutions are provided according to different trading mode.
5. **Trading mode – “trade_mode” (3 types):**
   * Trade mode “A”:
Exit price will be set to zero, this is the strictest condition, because we may be unable to sell at such a low liquidity. 
    * Trade mode “B”:
Exit price will be set the same as entry price, it means these stocks bring zero return during backtesting. 
    * Trade mode “C”:
Exit price will be the exact price on exit point regardless of low trade volume.
From the description above, we can find that trade mode “A”, “B”, “C” following the condition from strict to loose. Furthermore, if traded companies closed during backtesing, it’s exit price will be set as zero.
6. **How to form a portfolio (2 kinds of weights) – “weight_mode”:**
    * Equally weights:
Each stock has an equal weight in a portfolio.
    * Market-Value based weights:
Each stock’s weight is given according to it’s market value proportion in the portfolio.
7. **Initial capital – “initial_capital”:**
Initial capital invested at the beginning, it’s convenient to compare initial capital with the remain capital after backtesing to figure out whether an investment strategy is profitable or not.
8. **Transaction cost – “transaction_cost”:**
It costs 0.1425% to buy and sell a stock via broker, it also costs 0.3% on tax while selling a stock, so the total cost is 0.585%. 

There are total 8 parameters can be adjusted while backesting. However, it is more convenient to focus on how some important parameters affect result (remain capital), if we fix some parameters which is less important. As a result, during backtesting I will take “least_volume = 10”, “initial_capital = 100”, “transaction_cost = 0.585%” as given. 

At the end of this part, I will give serval examples to wrap up all the notations I had mentioned. For example, when seeing “MV_True_A_equal”, it means stocks in this portfolio is selected by market value in an ascending way, stocks are traded under trade mode “A”, and this portfolio is formed by equal weights. Another example, when seeing “PB_False_B_MVbased”, it means stocks in this portfolio is selected by price-to-book ratio in a descending way, stocks are traded under trade mode “B”, and this portfolio’s weight is based on market value. 
## Finding:
First, we look at all result from backtesting, there are five parameters “by”, “ascending”, “trade_mode”, “weight_mode”, each of it has 2, 2, 3, 2 possible values sequentially, so there are 2*2*3*2 = 24 possible combinations. Parameter “num_selected” is given with a sequence from 5 to 100 (step size = 5), so there are 20 possible values for it. As a result, there are total 24*20 = 480 combinations which means there are total 480 backtesting result, remain capital is plotted as a function of “num_selected” according to different investment strategy, the visualized result is shown as below (there are 24 lines):
![img](https://raw.githubusercontent.com/Andy-Liu66/2018NSYSU-Security-Analysis-and-Business-Valuation/master/Final%20Report/Used%20Picture/1.png)
Next, I will break the result above in multiple parts to analyze how parameters affect final return. I will take some parameters as given to focus on influence of specific parameters during the process:
1. **Are those high-return strategies (upper part of the plot above) realistic? (Given “trade_mode” = “B” or “C”):**
If traded stocks’ trade volume doesn’t meet the least requirement of trade volume, then exit price will be set as entry price or exact price at exit point sequentially in trading mode “B”,” C”. However, we might be unable to sell those stocks at that price because trade volume is too low. In this section, I will first check how small market value companies or small price-to-book ratio companies perform, given parameter “ascending = True”, the result is shown as below:
![img](https://raw.githubusercontent.com/Andy-Liu66/2018NSYSU-Security-Analysis-and-Business-Valuation/master/Final%20Report/Used%20Picture/2.png)
From the plot above, we can find that portfolios formed by small market value companies did perform very well, this result seems the same as the statement in Pablo Fernandez’s paper. However, the portfolios formed by small price-to-book-ratio companies didn’t seem to have outstanding performance in contrast to small market value portfolios, but it still outperformed market index. (“Taiwn_50” and “Initial Capital” don’t take number of stocks selected into consideration so they are horizontal lines.)
    What about companies with big market value and big price-to-book-ratio? The result is shown as below:    
![img](https://raw.githubusercontent.com/Andy-Liu66/2018NSYSU-Security-Analysis-and-Business-Valuation/master/Final%20Report/Used%20Picture/3.png)
Portfolios formed by big market value or price-to-book-ratio companies didn’t have any surprising result. Most of these portfolios’ return fall below market index’s performance. From the plot above, it seems there are only five lines (excluding “Taiwan_50”, and “Initial_Capital”), but there should be 8 lines, why did this happen? Let me show another plot:
![img](https://raw.githubusercontent.com/Andy-Liu66/2018NSYSU-Security-Analysis-and-Business-Valuation/master/Final%20Report/Used%20Picture/4.png)
From the plot above, we can clearly find that there are three pairs of line overlapping. It means there is no difference between trading mode “B”, and “C”. If traded stocks meet the requirement of least trade volume, it won’t consider any trading mode, it will use the excat exit price on the exit point. In strategies “PB_False_B_equal”, and “PB_False_C_equal” didn’t happen overlapping. However, “PB_False_B_MVbased”, and “PB_False_C_MVbased” strategies did happen overlapping, these strategies only different in “weight_mode”, they should have the same overlapping situation, why did this happen? After searching backtesting data, I found that high price-to-book ratio companies tend to have low trade volume on exit point (the number is small), but because the difference of “weight_mode” generate the overlapping or nonoverlapping situation. If portfolio are formed by market value based weights, because the companies with low trade volume (given “by = PB”, “ascending = False”) tend to have low market value, so the weights these companies got would be relative small. 
As a result, the difference between trading mode will be eliminated during backtesting, so overlapping happened. On the other hand, if portfolios were equally weighted, then the difference between trading mode wouldn’t be elimated, because every company got same weights. If we take a look at first plot in this section, we can find that portfolios formed by “MVbased” still have the overlpping or nonoverlapping situation at the same time, does it means the statement I has just made is wrong? Maybe not. Because whether the line will overlap or not still depend on the number of trades which didn’t meet the requirement of least trade volume, if the number is huge, then no matter how the weight is, nonoverlapping will still happen which means there is a difference between trade mode “B”,  and “C”.
The most important finding in this section is that portfolios formed by small market value companies do have high return, but the return may not be realistic, because the trade volume is too low which means we may be unable to sell it at given price.
2. **Realistic basis, what is the difference between strategies according to criteria of selection – “by” (given “trade_mode” = “A”):**
In this section, I will investigate the difference between strategies adopting different criteria of selection – market value or price-to-book ratio. Considering reality, I will discuss this section at trading mode “A”, taking the strictest condition during backtesting. Although it might undervalue the performance, but it is more conservative to do in this way. First, we look at how portfolios selected by market value perform:
![img](https://raw.githubusercontent.com/Andy-Liu66/2018NSYSU-Security-Analysis-and-Business-Valuation/master/Final%20Report/Used%20Picture/5.png)
From the plot above I got the finding below:
	* No matter portfolios formed by smallest or biggest market value companies, it seems that portfolios perform better if its weight base on market value.
	* As number of stocks selected increase, it seems that there is a convergence in the return. However, we can't say that all portfolios' return converges as the number of stocks selected increase, because in this article the highest number of stock selected is 100, we must increase the number to make such conclusion. As a result, we can't say biggest market value portfolios' return will decrease as number of stocks selected increase, and smallest market value portfolios' return will increase as the number of stocks selected increase, but from the plot above we might accepted this statement (if number of stock selected falls in the range from 5 to 100).
	* For portfolios formed by smallest market value companies (in strictest condition trade mode = “A”), if number of stock selected increase, the return increase as well. We can find that when the number of stocks selected is low, the return is bad or even zero, because in trade mode “A”, if traded stocks don't meet the requirement of least trade volume on exit point, then the exit price will be set to zero. As a result, if number of stocks in portfolio increase, it might diversify the risk of letting exit price set to zero, hence increasing the return. On the other hand, it also means that small market value companies tend to miss the requirement of least trade volume or the companies might had closed during backtesting.

    Next, we look at how portfolios selected by price-to-book ratio perform:
![img](https://raw.githubusercontent.com/Andy-Liu66/2018NSYSU-Security-Analysis-and-Business-Valuation/master/Final%20Report/Used%20Picture/6.png)
From the plot above I got the finding below:
	* For small price-to-book ratio portfolios, portfolios perform better in equal weights. On the contrary, for big price-to-book ratio portfolios, it has better performance if portfolios’ weight base on market value.
	* The highest performance for small price-to-book ratio portfolios happens at number of stocks selected equal to 25, while the number of stocks selected increase, the performance doesn’t increase as well. For high price-to-book ratio portfolio, if portfolio is equally weighted, we can find that performance coverages while number of stocks selected increase, but if portfolio’s weight base on market value, portfolios’ performance seems to increase while the number of stocks selected increase.
	* We can find that all portfolios selected by price-to-book ratio tend to have bad performance when number of stocks selected is small (lower left corner of plot above). No matter stocks in the portfolios selected by high or low price-to-book ratio, it all tend to have low trade volume (missing the requirement of least trade volume), or companies might had closed during backtesting.
## Conclusion:
We can find that portfolios formed by smallest market value companies perform very well (over 300% or even 1300% according to different number of stocks selected) in both equal weights and market-value based weights. However, these high performances only happen at trading mode “B”, “C” (loose condition). It seems quite unrealistic, but it's the only way to find the best result during backtesting. As a result, the conclusion from “It has been very easy to beat the S&P500 in 2000-2018” might be done without considering the trade volume on exit point (author didn't mention any thing about trade volume in his paper). It means on theory, our portfolios formed by small market value companies can bring huge return, but on realistic, we can't enjoy the huge return because we couldn't sell those stocks at exact price. However, the stock price still rises although it has low trade volume, but the reason it rises might also because of the low trade volume (it’s easier to raise the price).

Another finding is that portfolios formed by small market value stocks tend to have small trade volume (missing requirement of least trade volume) or companies even closed during backtesting. On the other hand, portfolios formed by no matter small or big price-to-book ratio companies all tend to have small trade volume (missing requirement of least trade volume) or companies even closed during backtesting. But how is the proportion between “small trade volume” and “companies closed” that led to low performance on above situation remain further research (because of the way I wrote the code, I didn’t save all trading records, so I can’t figure it out).
## Feed Back:
The code and data are provided in this repository, readers can play around with it. If you have any comment, please email me at: andy566159@gmail.com

Thanks for reading.